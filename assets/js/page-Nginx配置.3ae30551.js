(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{921:function(s,t,n){"use strict";n.r(t);var a=n(1),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"文件结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件结构"}},[s._v("#")]),s._v(" 文件结构")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局块")]),s._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#events块")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http全局块")]),s._v("\n    server        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server块")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server全局块")]),s._v("\n        location "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PATTERN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location块")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PATTERN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    server\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http全局块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("全局块")]),s._v("：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。")]),s._v(" "),n("li",[n("strong",[s._v("events块")]),s._v("：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。")]),s._v(" "),n("li",[n("strong",[s._v("http块")]),s._v("：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。")]),s._v(" "),n("li",[n("strong",[s._v("server块")]),s._v("：配置虚拟主机的相关参数，一个http中可以有多个server。")]),s._v(" "),n("li",[n("strong",[s._v("location块")]),s._v("：配置请求的路由，以及各种页面的处理情况。")])]),s._v(" "),n("h2",{attrs:{id:"配置示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置示例"}},[s._v("#")]),s._v(" 配置示例")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义Nginx运行的用户和用户组")]),s._v("\nuser www www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx进程数，建议设置为等于CPU总核心数。")]),s._v("\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]")]),s._v("\nerror_log ar/loginx/error.log info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进程文件")]),s._v("\npid ar/runinx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。")]),s._v("\nworker_rlimit_nofile "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#工作模式与连接数上限")]),s._v("\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。")]),s._v("\n    use epoll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#单个进程最大连接数（最大连接数=连接数*进程数）")]),s._v("\n    worker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定http服务器")]),s._v("\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件扩展名与文件类型映射表")]),s._v("\n    default_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认文件类型")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset utf-8; #默认编码")]),s._v("\n    server_names_hash_bucket_size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务器名字的hash表大小")]),s._v("\n    client_header_buffer_size 32k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件大小限制")]),s._v("\n    large_client_header_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定请求缓")]),s._v("\n    client_max_body_size 8m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定请求缓")]),s._v("\n    sendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。")]),s._v("\n    autoindex on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启目录列表访问，合适下载服务器，默认关闭。")]),s._v("\n    tcp_nopush on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止网络阻塞")]),s._v("\n    tcp_nodelay on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止网络阻塞")]),s._v("\n    keepalive_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#长连接超时时间，单位是秒")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。")]),s._v("\n    fastcgi_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_send_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_read_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffer_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_busy_buffers_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_temp_file_write_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip模块设置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启gzip压缩输出")]),s._v("\n    gzip_min_length 1k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小压缩文件大小")]),s._v("\n    gzip_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 16k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩缓冲区")]),s._v("\n    gzip_http_version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）")]),s._v("\n    gzip_comp_level "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩等级")]),s._v("\n    gzip_types text/plain application/x-javascript text/css application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩类型，默认就已经包含textml，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。")]),s._v("\n    gzip_vary on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用")]),s._v("\n\n    upstream blog.ha97.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.121:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.122:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.123:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟主机的配置")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监听端口")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#域名可以有多个，用空格隔开")]),s._v("\n        server_name www.ha97.com ha97.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index index.html index.htm index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        root /data/www/ha97"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("php"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("php5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            fastcgi_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fastcgi_index index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            include fastcgi.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            deny "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拒绝的ip")]),s._v("\n           \tallow "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".5.54"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许的ip    ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片缓存时间设置")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。")]),s._v("\n            expires 10d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#JS和CSS缓存时间设置")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 1h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志格式设定")]),s._v("\n        log_format access "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"$http_user_agent\" $http_x_forwarded_for'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义本虚拟主机的访问日志")]),s._v("\n        access_log ar/loginx/ha97access.log access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#对 "/" 启用反向代理')]),s._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_pass http://127.0.0.1:88"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_redirect off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP")]),s._v("\n            proxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以下是一些反向代理的配置，可选。")]),s._v("\n            proxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            client_max_body_size 10m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许客户端请求的最大单文件字节数")]),s._v("\n            client_body_buffer_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓冲区代理缓冲用户端请求的最大字节数，")]),s._v("\n            proxy_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx跟后端服务器连接超时时间(代理连接超时)")]),s._v("\n            proxy_send_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端服务器数据回传时间(代理发送超时)")]),s._v("\n            proxy_read_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接成功后，后端服务器响应时间(代理接收超时)")]),s._v("\n            proxy_buffer_size 4k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置代理服务器（nginx）保存用户头信息的缓冲区大小")]),s._v("\n            proxy_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 32k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_buffers缓冲区，网页平均在32k以下的设置")]),s._v("\n            proxy_busy_buffers_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#高负荷下缓冲大小（proxy_buffers*2）")]),s._v("\n            proxy_temp_file_write_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定缓存文件夹大小，大于这个值，将从upstream服务器传")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定查看Nginx状态的地址")]),s._v("\n        location /NginxStatus "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            stub_status on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            access_log on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            auth_basic "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NginxStatus"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            auth_basic_user_file confpasswd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#htpasswd文件的内容可以用apache提供的htpasswd工具来产生。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本地动静分离反向代理配置")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有jsp的页面均交由tomcat或resin处理")]),s._v("\n        location ~ ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jsp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jspx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://127.0.0.1:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有静态文件由nginx直接读取不经过tomcat或resin")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ioc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rar")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("txt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("flv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("doc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ppt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("pdf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xls"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mp3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wma"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$\n         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 15d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$\n         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 1h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br")])]),n("h2",{attrs:{id:"配置说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置说明"}},[s._v("#")]),s._v(" 配置说明")]),s._v(" "),n("h3",{attrs:{id:"location"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[s._v("#")]),s._v(" location")]),s._v(" "),n("blockquote",[n("p",[s._v("位置可以由"),n("code",[s._v("前缀字符串")]),s._v("或"),n("code",[s._v("正则表达式")]),s._v("定义。正则表达式由前面的“ "),n("code",[s._v("~*")]),s._v("”修饰符(不区分大小写的匹配)或“ "),n("code",[s._v("~")]),s._v("”修饰符(区分大小写的匹配)指定。为了找到与给定请求匹配的位置，nginx 首先检查使用前缀字符串定义的位置(前缀位置)。其中，选择并记住具有最长匹配前缀的位置。然后按照在配置文件中出现的顺序检查正则表达式。正则表达式的搜索在第一个匹配项上终止，并使用相应的配置。如果未找到与正则表达式匹配的内容，则使用前面记住的前缀位置的配置。")])]),s._v(" "),n("p",[s._v("语法：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("location "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ~ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ~* "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ^~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" uri "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("命令")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("~")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("表示执行一个正则匹配，区分大小写")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("~*")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("表示执行一个正则匹配，不区分大小写")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("^~")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配其他。一般用来匹配目录")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("=")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("进行普通字符精确匹配，如果找到完全匹配的内容，搜索将终止。")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("@")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("定义一个命名的location，使用在内部定向时；")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("无前缀")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("用于普通字符串")])])])]),s._v(" "),n("div",{staticClass:"custom-block info"},[n("p",{staticClass:"custom-block-title"},[s._v("相关信息")]),s._v(" "),n("p",[n("code",[s._v("~")]),s._v(" 和"),n("code",[s._v("~*")]),s._v(" 用于正则表达式，其他前缀和无任何前缀都用于普通字符串。正则表达式会根据匹配顺序，匹配到第一个正则表达式后停止搜索。普通字符串匹配则无视顺序，只会选择最精确的匹配。")])]),s._v(" "),n("h3",{attrs:{id:"匹配优先级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#匹配优先级"}},[s._v("#")]),s._v(" 匹配优先级")]),s._v(" "),n("p",[s._v("nginx有两层指令来匹配请求 URI 。第一个层次是 server 指令，它通过域名、ip 和端口来做第一层级匹配，当找到匹配的 server 后就进入此 server 的 location 匹配。")]),s._v(" "),n("p",[n("strong",[s._v("location 的匹配并不完全按照其在配置文件中出现的顺序来匹配，请求URI 会按如下规则进行匹配：")])]),s._v(" "),n("ol",[n("li",[s._v("先精准匹配 = ，精准匹配成功则会立即停止其他类型匹配；")]),s._v(" "),n("li",[s._v("没有精准匹配成功时，进行前缀匹配。先查找带有 ^~ 的前缀匹配，带有 ^~ 的前缀匹配成功则立即停止其他类型匹配，普通前缀匹配（不带参数 ^~ ）成功则会暂存，继续查找正则匹配；")]),s._v(" "),n("li",[s._v("= 和 ^~ 均未匹配成功前提下，查找正则匹配 ~ 和 ~* 。当同时有多个正则匹配时，按其在配置文件中出现的先后顺序优先匹配，命中则立即停止其他类型匹配；")]),s._v(" "),n("li",[s._v("所有正则匹配均未成功时，返回步骤 2 中暂存的普通前缀匹配（不带参数 ^~ ）结果")])]),s._v(" "),n("p",[s._v("以上规则简单总结就是优先级从高到低依次为（"),n("strong",[s._v("序号越小优先级越高")]),s._v("）：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精准匹配")]),s._v("\nlocation ^~   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 带参前缀匹配")]),s._v("\nlocation ~    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则匹配（区分大小写）")]),s._v("\nlocation ~*   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则匹配（不区分大小写）")]),s._v("\nlocation /a   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 普通前缀匹配，优先级低于带参数前缀匹配。")]),s._v("\nlocation /    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 任何没有匹配成功的，都会匹配这里处理")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"last-和-break"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#last-和-break"}},[s._v("#")]),s._v(" last 和 break")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("last 和 break 当出现在location 之外时，两者的作用是一致的没有任何差异")])]),s._v(" "),n("li",[n("p",[s._v("last 和 break 当出现在location 内部时：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("关键字")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("last")]),s._v(" "),n("td",[s._v("使用了last 指令，rewrite 后会跳出location 作用域，重新开始再走一次刚才的行为")])]),s._v(" "),n("tr",[n("td",[s._v("break")]),s._v(" "),n("td",[s._v("使用了break 指令，rewrite后不会跳出location 作用域，它的生命也在这个location中终结")])])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);